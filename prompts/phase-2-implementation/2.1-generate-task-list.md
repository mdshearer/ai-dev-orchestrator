# Prompt: Generate Task List from Tech Spec

**Persona:** Project Manager (uses Solutions Architect knowledge)
**Phase:** 2 - Implementation
**Purpose:** Break down a tech spec into granular, sequential tasks

---

## When to Use This Prompt

✅ **Use when:**
- You have an approved tech spec
- You're ready to start implementation
- You need a clear, ordered list of tasks

❌ **Don't use when:**
- You don't have a tech spec yet (use Phase 1 first)
- The task is trivial (single file change)
- You want to write code (use 2.2-iterative-implementation instead)

---

## The Prompt Template

```markdown
You are a Project Manager working with a development team. Take the attached technical specification and break it down into a granular, step-by-step task list for the developer to implement.

**Rules:**
1. Review the entire `[feature-name]-tech-spec.md` file thoroughly
2. Each task must be:
   - A single, small, verifiable change
   - Independent (or clearly state dependencies)
   - Specific (include file names and what to do)
   - Testable (developer knows when it's done)
3. Tasks must be in the correct **logical order** of implementation
   - Database changes first
   - Then backend services/API
   - Then frontend (if applicable)
   - Then tests
4. Reference specific sections of the tech spec for each task
5. If a task depends on another, note: "Depends on: Task #X"

**Output Format:**
- Markdown file with numbered tasks
- Each task should have:
  - Task number
  - Clear description
  - File(s) to create or modify
  - Reference to tech spec section
  - (Optional) Estimated complexity: [Simple / Medium / Complex]

**File to Save:**
- `docs/[feature-name]-tasks.md`

---

**Files to Attach:**
- `[feature-name]-tech-spec.md`
- `CONSTITUTION.md` (for context on standards)
```

---

## Interactive Mode (Recommended for Beginners)

When using interactive mode, add this to your prompt:

**"Use interactive mode: Present parent tasks first, wait for my 'Go' confirmation, then generate sub-tasks."**

The AI will:
1. Generate high-level parent tasks (usually 5-7 phases)
2. Say: "I've generated X parent tasks. Ready for sub-tasks? Reply 'Go' to continue."
3. Wait for your confirmation
4. Generate detailed sub-tasks for each parent task

### Why Use Interactive Mode?

- **Validate approach early** - Review the high-level phases before committing to details
- **Catch missing pieces** - Easier to spot gaps in 7 parent tasks than 40 sub-tasks
- **Stay oriented** - Always know which phase you're in
- **Prevent overwhelm** - Digest the plan in stages

### Example Interactive Flow

**Step 1: AI generates parent tasks**
```markdown
I've broken down the password-reset feature into these parent tasks:

- [ ] 1. Set up database schema
- [ ] 2. Create backend services
- [ ] 3. Build API endpoints
- [ ] 4. Add email templates
- [ ] 5. Implement tests
- [ ] 6. Add documentation

Ready for sub-tasks? Reply "Go" to continue.
```

**Step 2: You review and respond**
```
Looks good! Go
```

**Step 3: AI generates all detailed sub-tasks**
```markdown
Here are the detailed sub-tasks:

### 1. Set up database schema
- [ ] 1.1 Create password_reset_tokens table in schema.sql
- [ ] 1.2 Add indexes for performance
- [ ] 1.3 Create migration file
- [ ] 1.4 Run migration and test

### 2. Create backend services
- [ ] 2.1 Create TokenGenerator utility
- [ ] 2.2 Create PasswordResetService class skeleton
...
```

## Task Tracking

Always use checkbox format:
- `- [ ]` for incomplete tasks
- `- [x]` for completed tasks

Instruct the AI: **"Mark each sub-task complete immediately after finishing it."**

This keeps your progress visible and prevents the AI from re-doing completed work.

### Task Completion Protocol

After completing each sub-task, the AI should:
1. Mark it `[x]` in the task list
2. Update the task list file
3. Ask: "Sub-task X.Y complete. Ready for X.Y+1?"
4. Wait for your approval before proceeding

When all sub-tasks under a parent are complete:
1. Run tests (if applicable)
2. Commit changes with descriptive message
3. Mark the parent task `[x]` complete

---

## How to Use This Prompt

### Step 1: Prepare Your Tech Spec

Ensure you have:
- [ ] Approved tech spec (`[feature-name]-tech-spec.md`)
- [ ] `CONSTITUTION.md`

### Step 2: Invoke the AI

Paste the prompt with the tech spec attached.

### Step 3: Review the Task List

Check for:
- [ ] Tasks are in logical order
- [ ] Each task is small enough (< 1 hour ideally)
- [ ] Dependencies are clear
- [ ] File paths are specific
- [ ] You understand what each task means

### Step 4: Adjust if Needed

If tasks are too large:
- "Break task #5 into smaller sub-tasks"

If order is wrong:
- "Move task #8 before task #3 (database should come first)"

### Step 5: Save and Start Implementation

Once approved:
1. Save to `docs/[feature-name]-tasks.md`
2. Start with Task #1
3. Use prompt 2.2 for implementation

---

## Example Input

```markdown
**Tech Spec:** password-reset-tech-spec.md (attached)
**Constitution:** CONSTITUTION.md (attached)
```

---

## Example Output (What the Project Manager Should Generate)

````markdown
# Task List: Password Reset Feature

**Source:** `docs/password-reset-tech-spec.md`
**Created:** 2025-11-14
**Status:** Ready for Implementation

---

## Phase 1: Database Setup

### Task 1: Create password_reset_tokens table
**Description:** Create the database migration for the password_reset_tokens table

**Files to CREATE:**
- `database/migrations/003_password_reset_tokens.sql`

**What to do:**
- Write SQL to create `password_reset_tokens` table (see tech spec §2)
- Include: id, user_id, token_hash, created_at, expires_at, used_at
- Add foreign key to users table
- Add indexes on: user_id, token_hash, expires_at
- Add CHECK constraint: expires_at > created_at
- Include sample test data (3 rows)

**Reference:** Tech Spec §2 (Data Model)
**Complexity:** Simple

---

### Task 2: Run database migration
**Description:** Apply the migration to create the table

**Command:**
```bash
psql -d your_database -f database/migrations/003_password_reset_tokens.sql
```

**Verify:** Run `\d password_reset_tokens` to confirm table exists

**Reference:** Tech Spec §2
**Complexity:** Simple
**Depends on:** Task #1

---

## Phase 2: Backend Services

### Task 3: Create TokenGenerator utility
**Description:** Create a utility module for generating and hashing tokens

**Files to CREATE:**
- `src/utils/token-generator.ts`

**What to do:**
- Export function `generate()`: Generate 32-byte random hex string
- Export function `hash(token: string)`: Hash token with bcrypt
- Add JSDoc comments (per CONSTITUTION.md)
- Include error handling

**Reference:** Tech Spec §4 (Key Components)
**Complexity:** Simple

---

### Task 4: Create PasswordResetService - Basic structure
**Description:** Create the service file with class skeleton

**Files to CREATE:**
- `src/services/password-reset.service.ts`

**What to do:**
- Create `PasswordResetService` class
- Add constructor (inject dependencies: db, emailService, tokenGenerator)
- Add method stubs (empty) for:
  - `createResetToken(email: string): Promise<void>`
  - `verifyToken(token: string): Promise<{valid: boolean, userId?: string}>`
  - `resetPassword(token: string, newPassword: string): Promise<void>`
- Add class-level JSDoc comment

**Reference:** Tech Spec §4
**Complexity:** Simple

---

### Task 5: Implement createResetToken method
**Description:** Implement the password reset request logic

**Files to MODIFY:**
- `src/services/password-reset.service.ts`

**What to do:**
- Look up user by email (use existing UserModel.findByEmail)
- If user doesn't exist, return early (don't error - security)
- Check rate limit: Max 3 requests per email per hour
- Generate token using TokenGenerator
- Hash token
- Calculate expiry (1 hour from now)
- Save to database
- Queue email (use background task)
- Add error handling
- Add method JSDoc

**Reference:** Tech Spec §4, §6, §7
**Complexity:** Complex
**Depends on:** Task #3, Task #4

---

### Task 6: Implement verifyToken method
**Description:** Implement token validation logic

**Files to MODIFY:**
- `src/services/password-reset.service.ts`

**What to do:**
- Hash provided token
- Look up token in database by hash
- Check if exists, not expired, not used
- Return `{valid: true, userId: xxx}` if valid
- Return `{valid: false}` if invalid
- Add error handling
- Add method JSDoc

**Reference:** Tech Spec §4, §7
**Complexity:** Medium
**Depends on:** Task #4

---

### Task 7: Implement resetPassword method
**Description:** Implement password reset confirmation logic

**Files to MODIFY:**
- `src/services/password-reset.service.ts`
- `src/models/user.model.ts` (add updatePassword method)

**What to do:**
- Call verifyToken to validate
- Validate new password complexity (per CONSTITUTION.md)
- Hash new password (bcrypt, 10 rounds)
- Update user password (UserModel.updatePassword - create this method)
- Mark token as used (set used_at timestamp)
- Invalidate all user sessions (SessionService.invalidateAll)
- Send confirmation email (background task)
- Add error handling
- Add method JSDoc

**Reference:** Tech Spec §4, §5, §6, §7
**Complexity:** Complex
**Depends on:** Task #6

---

## Phase 3: API Endpoints

### Task 8: Create password-reset route file
**Description:** Create the API route handlers

**Files to CREATE:**
- `src/api/routes/password-reset.ts`

**What to do:**
- Import PasswordResetService
- Create router instance
- Add route stubs (empty handlers) for:
  - POST /password-reset/request
  - GET /password-reset/verify
  - POST /password-reset/confirm
- Export router

**Reference:** Tech Spec §3
**Complexity:** Simple

---

### Task 9: Implement POST /password-reset/request endpoint
**Description:** Handle password reset requests

**Files to MODIFY:**
- `src/api/routes/password-reset.ts`

**What to do:**
- Validate request body (email field required, valid email format)
- Call PasswordResetService.createResetToken(email)
- Return 200 with message (always, even if email doesn't exist)
- Handle errors per CONSTITUTION.md format
- Add rate limiting (see tech spec §6)

**Reference:** Tech Spec §3, §6
**Complexity:** Medium
**Depends on:** Task #5, Task #8

---

### Task 10: Implement GET /password-reset/verify endpoint
**Description:** Verify reset token validity

**Files to MODIFY:**
- `src/api/routes/password-reset.ts`

**What to do:**
- Get token from query parameter
- Call PasswordResetService.verifyToken(token)
- Return 200 with {valid: true/false, email: masked}
- Return 400 if invalid with proper error code
- Handle errors per CONSTITUTION.md format

**Reference:** Tech Spec §3, §7
**Complexity:** Simple
**Depends on:** Task #6, Task #8

---

### Task 11: Implement POST /password-reset/confirm endpoint
**Description:** Complete password reset

**Files to MODIFY:**
- `src/api/routes/password-reset.ts`

**What to do:**
- Validate request body (token, new_password)
- Call PasswordResetService.resetPassword(token, newPassword)
- Return 200 with success message
- Return 400 for weak password or invalid token
- Handle errors per CONSTITUTION.md format

**Reference:** Tech Spec §3, §7
**Complexity:** Medium
**Depends on:** Task #7, Task #8

---

### Task 12: Register password-reset routes
**Description:** Add routes to main API router

**Files to MODIFY:**
- `src/api/routes/index.ts`

**What to do:**
- Import password-reset router
- Register with prefix: `/api/auth`
- Add to route list

**Reference:** Tech Spec §1
**Complexity:** Simple
**Depends on:** Task #11

---

## Phase 4: Email Templates

### Task 13: Add password reset email template
**Description:** Create email template for reset link

**Files to MODIFY:**
- `src/services/email.service.ts` (or templates/password-reset.html if separate)

**What to do:**
- Create HTML email template with:
  - Reset link (with token)
  - Expiry time (1 hour)
  - Security notice
- Add method to EmailService: `sendPasswordResetEmail(email, token, userName)`

**Reference:** Tech Spec §5
**Complexity:** Simple

---

### Task 14: Add password reset confirmation email template
**Description:** Create confirmation email after successful reset

**Files to MODIFY:**
- `src/services/email.service.ts`

**What to do:**
- Create HTML email template confirming password was changed
- Include security notice: "If you didn't do this, contact support"
- Add method to EmailService: `sendPasswordResetConfirmationEmail(email, userName)`

**Reference:** Tech Spec §5
**Complexity:** Simple

---

## Phase 5: Testing

### Task 15: Write unit tests for PasswordResetService
**Description:** Test all service methods

**Files to CREATE:**
- `tests/unit/services/password-reset.service.test.ts`

**What to do:**
- Test createResetToken: valid email, invalid email, rate limiting
- Test verifyToken: valid token, expired token, used token, invalid token
- Test resetPassword: valid token, invalid token, weak password
- Use mocks for database and email service
- Aim for 80%+ code coverage

**Reference:** Tech Spec §8
**Complexity:** Complex

---

### Task 16: Write integration tests for API endpoints
**Description:** Test end-to-end API flows

**Files to CREATE:**
- `tests/integration/api/password-reset.test.ts`

**What to do:**
- Test full flow: request → verify → confirm
- Test error cases: expired token, used token, weak password
- Test rate limiting
- Use test database
- Clean up test data after each test

**Reference:** Tech Spec §8
**Complexity:** Complex

---

### Task 17: Manual testing
**Description:** Test the feature manually

**What to do:**
- [ ] Request password reset for existing email
- [ ] Verify email is received
- [ ] Click link and verify token
- [ ] Submit new password
- [ ] Verify password changed (can log in with new password)
- [ ] Verify old sessions invalidated
- [ ] Test error cases (expired link, used link)

**Reference:** Tech Spec §8
**Complexity:** Simple

---

## Summary

**Total Tasks:** 17
**Estimated Time:** 2-3 days (depending on developer experience)

**Task Breakdown:**
- Database: 2 tasks
- Backend Services: 5 tasks
- API Endpoints: 5 tasks
- Email Templates: 2 tasks
- Testing: 3 tasks

**Next Steps:**
1. Review this task list
2. Start with Task #1
3. Use prompt 2.2-iterative-implementation.md for each task
4. Mark tasks complete as you go
````

---

## Tips for Better Task Lists

### ✅ DO:
- Keep tasks small (< 1 hour each)
- Order tasks logically (dependencies first)
- Be specific about files
- Include verification steps
- Note complexity
- Reference tech spec sections

### ❌ DON'T:
- Create huge tasks ("implement entire feature")
- Skip dependencies
- Be vague ("fix the API")
- Forget testing tasks
- Ignore error handling

---

## Task Complexity Guide

- **Simple:** < 30 minutes, single file, no dependencies
- **Medium:** 30min-1hr, multiple files or moderate logic
- **Complex:** 1-2 hours, complex logic, multiple integrations

---

## Next Steps After Task List Creation

1. **Save** to `docs/[feature-name]-tasks.md`
2. **Review** with your team (if applicable)
3. **Start Task #1** using [2.2-iterative-implementation.md](./2.2-iterative-implementation.md)

---

## Related Resources

- [AI Dev Tasks - Task Management](https://github.com/snarktank/ai-dev-tasks)
- Previous: [API Design](../phase-1-planning/1.4-architect-api-design.md)
- Next: [Iterative Implementation](./2.2-iterative-implementation.md)
